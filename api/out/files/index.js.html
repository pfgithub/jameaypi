<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>index.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Game.Canvas.html">Game.Canvas</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Game.html">Game</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var util = require(&#x27;util&#x27;);
var events = require(&#x27;events&#x27;);
var keys = require(&#x27;./keys.json&#x27;);
/**
 * The game api
 *
 * @module Game
 */
 
var screen = document.createElement(&#x27;canvas&#x27;);

screen.width  = window.innerWidth;
screen.height = window.innerHeight;
screen.style.position = &quot;fixed&quot;;
screen.style.top   = &quot;0&quot;;
screen.style.left   = &quot;0&quot;;
screen.style.width  = &quot;100%&quot;;
screen.style.height = &quot;100%&quot;;
 
var buffer = document.createElement(&#x27;canvas&#x27;);

buffer.width  = window.innerWidth;
buffer.height = window.innerHeight;
buffer.style.display = &quot;none&quot;;

function clone(obj) {
  if(obj === null || typeof(obj) !== &#x27;object&#x27; || &#x27;isActiveClone&#x27; in obj)
    return obj;

  var temp = obj.constructor(); // changed

  for(var key in obj) {
    if(Object.prototype.hasOwnProperty.call(obj, key)) {
      obj[&#x27;isActiveClone&#x27;] = null;
      temp[key] = clone(obj[key]);
      delete obj[&#x27;isActiveClone&#x27;];
    }
  }    

  return temp;
}

window.addEventListener(&quot;resize&quot;, function(){
  var w = window.innerWidth;
  var h = window.innerHeight;
  buffer.width = w;
  buffer.height = h;
  buffer.getContext(&#x27;2d&#x27;).drawImage(screen, 0, 0);
  
  screen.width = w;
  screen.height = h;
  screen.getContext(&#x27;2d&#x27;).drawImage(buffer, 0, 0);
  
  ev.out(&#x27;resize&#x27;);
});

document.addEventListener(&#x27;keydown&#x27;,function(e){
  var key = keys[e.keyCode];
  ev.out(&#x27;keydown&#x27;, key);
});

document.addEventListener(&#x27;keyup&#x27;,function(e){
  var key = keys[e.keyCode];
  ev.out(&#x27;keyup&#x27;, key);
});

document.body.appendChild(screen);
document.body.appendChild(buffer);

function Events(){this.x = 0;}
util.inherits(Events, events.EventEmitter);
Events.prototype.out = function(data){
  this.emit.apply(this, arguments);
};

var screenObj = new Canvas(screen);
/**
 * The main canvas class
 *
 * @class Canvas
 * @param {int} width The width
 * @param {int} height The height
 * @namespace Game
 * @constructor
 */
function Canvas(w,h){
  if(typeof w != &quot;number&quot;)this.canvas = w;
  else{
    this.canvas = document.createElement(&#x27;canvas&#x27;);
    this.canvas.width  = w;
    this.canvas.height = h;
  }
  this.ctx = this.canvas.getContext(&quot;2d&quot;);
  this.w = this.canvas.width;
  this.h = this.canvas.height;
  
  this.spriteList = new SpriteList(this);
}

Canvas.prototype.drawImage = function(image,x,y){
  try {this.ctx.drawImage(image.canvas, x,y);return true;}
  catch(err) {console.log(&#x27;Could not draw canvas&#x27;,image,err);return false;}
};

Canvas.prototype.registerSprite = function(sprite){
  this.spriteList.addSprite(sprite);
};

Canvas.prototype.clear = function(){
  this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
};

/**
 * Do not load an image multiple times. Reuse your image variables
 *
 * @class Canvas
 * @param {int} width The width
 * @param {int} height The height
 * @namespace Game
 * @constructor
 */

function convertImageToCanvas(image) {
	var canvas = document.createElement(&quot;canvas&quot;);
	canvas.width = image.width;
	canvas.height = image.height;
	canvas.getContext(&quot;2d&quot;).drawImage(image, 0, 0);

	return canvas;
}

function Image(url){
  this.img = document.createElement(&#x27;img&#x27;);
  this.img.src = url;
  this.img.addEventListener(&quot;load&quot;,function(){
    this.canvas = convertImageToCanvas(this.img);
    this.w = this.img.width;
    this.h = this.img.height;
    
    this.emit(&#x27;load&#x27;);
  }.bind(this));
}
util.inherits(Image, events.EventEmitter);
Image.prototype.draw = function(canvas, x, y){
  canvas.drawImage(this,x,y);
};

function SpriteList(canvas){
  this.sprites = [];
  this.canvas = canvas;
}
SpriteList.prototype.addSprite = function(sprite){
  this.sprites.push(sprite);
};
SpriteList.prototype.draw = function(){
  if(this.sprites.length == 0) return;
  this.sprites.forEach(function(sprite){
    sprite.update();
      
    sprite.draw(this.canvas);
  }.bind(this));
  return true;
};

function Sprite(image,x,y){
  this.image = image;
  this.canvas = new Canvas(this.image.w,this.image.h);
  
  this.x = x;
  this.y = y;
  
  this.update();
}
util.inherits(Sprite,events.EventEmitter);
Sprite.prototype.draw = function(canvas){
  this.image.draw(canvas,this.x,this.y);
};
Sprite.prototype.update = function(callback){
  this.canvas.clear();
  return this.image.draw(this.canvas,0,0);
};


function awaitImages(images,callback){
  var counter = images.length;
  if(counter == 0) {callback(images);return;}
  images.forEach(function(image){
    image.on(&#x27;load&#x27;,function(){
      counter --;
      
      if(counter == 0) {callback(images);return;}
    });
  });
}

setInterval(onTimerTick, 33); // 33 milliseconds = ~ 30 frames per sec

function onTimerTick() {
  ev.out(&#x27;update&#x27;, 0.033);
  ev.out(&#x27;draw&#x27;);
}



var ev = new Events();

module.exports = {};
module.exports.Canvas = Canvas;
module.exports.screen = screenObj;
module.exports.Sprite = Sprite;
module.exports.Image = Image;
module.exports.awaitImages = awaitImages;
module.exports.events = ev;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
